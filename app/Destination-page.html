<!DOCTYPE html>
<html>
<head>
    <title>Destinara | Destination info</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../assets/css/jquery.mobile-1.4.5.min.css"/>
    <link rel="stylesheet" href="../assets/css/style.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/js/fontawesome.min.js"></script>
    <link rel="stylesheet" href="../font-aw/css/all.css" />

<!--    firebase-->
    <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-database.js"></script>
    <script src="../assets/js/firebaseInitialise.js"></script>
        <script>
        let searchParams = new URLSearchParams(window.location.search);
        let id = searchParams.get('id');
        let selectedDestination;
        var activies = [{}];
        $.ajax({
            type: 'GET',
            async :false,
            url: '../Json/ActivityInfo.json',
            data: { get_param: 'value' },
            dataType: 'json',
            success: function (data) {
                $.each(data, function(index, element) {
                    activies.push(element)
                });
            }
        });


        $.ajax({
            type: 'GET',
            url: '../Json/destinationInfo.json',
            data: { get_param: 'value' },
            dataType: 'json',
            success: function (data) {

                $.each(data, function(index, element) {
                    if(element.destination_id == id){
                        selectedDestination = element;
                        console.log("Destination ",selectedDestination);
                        $('.destination-img').hide().attr('src', element.imageurl).show();
                        $('.destination-desc').text(element.description);
                        $("#bookticket").attr("href", "BookTickets.html?id="+element.destination_id);
                        $('.destination-name').append(element.name +  `<i class='far fa-heart' id="heartIt" style='float: right'></i>`);
                        $.each(element.activities, function(index, element) {
                            $.each(activies, function(i, item) {
                                if(item.activity == element){
                                    console.log(item.activity);
                                    $('.destination-activies').append("<div class='des-cont'><div class='definition-act-cont' onclick='myFunction("+ item.activity +")'><img src="+item.imageurl+" alt='Avatar' class='definition-act-img'>\n" +
                                        "<div class='definition-act-over'><div class='definition-act-text'>"+item.name +"</div></div></div></div>")
                                }
                            });
                        });

                        $("#heartIt").on("click",function () {
                            console.log("add to favourite");
                            var newKey = firebase.database().ref().child('favourites').push().key;
                            return firebase.database().ref('favourites/user1/'+newKey).set({
                                destinationImg: selectedDestination['imageurl'],
                                location: selectedDestination['name']
                            }, function(error) {
                                if (error) {
                                    // The write failed...
                                    console.log("Data adding failed");
                                } else {
                                    $(".destination-name").empty();
                                    $('.destination-name').append(selectedDestination['name'] +  `<i class='fa fa-heart' id="heartIt" style='float: right'></i>`);
                                    console.log("Data added successfully");
                                    // Data saved successfully!
                                }
                            });
                        })
                    }
                });

            }
        });
    </script>
</head>
<body>
<div data-role="page">
    <div data-role="header"  class="head" data-position="fixed" style="position: fixed">
        <div   class="head" style="background-color: #FF8F77">
            <div class="back">
                <a onclick="history.back()"><img src="../assets/images/icons/back.png"></a>
            </div>

            <div class="head-text">
                Destination info
            </div>
            <a href = "#mypanel" style="position: absolute ;top: 45%; right: 20px;height: 100%; color: #f9f9f9;"> <i class="fas fa-bars"></i></a>
        </div>
    </div><!-- /header -->
    <div data-role="panel" id="mypanel" data-display="overlay">
        <div data-position="fixed">
            <div style="height: 130px;text-align: center;margin-top: 20px">
                <img  style="float: none !important;" class="lb-profile-pic" src="../assets/images/profile/profile-pic.jpg">
                <div class="lb-profile-text">
                    <p class="lb-profile-name">Dillon Paulusz</p>
                </div>
            </div>
            <br>
            <ul data-role="listview" data-inset="true">
                <li><a href="#">Cart</a></li>
                <li><a href="AboutUs.html">About us</a></li>
            </ul>
            <div style="position: fixed;text-align: center;bottom: 51px;left: 0;right: 0">
                <div style="margin: 10px">
                    <a class="button-def ui-shadow" data-ajax="false" href="#">logout</a>
                </div>

            </div>
        </div>
    </div>
    <div style="padding: 15px">
        <div class="destination-info">
            <img class="destination-img">
            <div class="destination-name"></div>

            <div class="destination-desc" style="padding: 5px"></div>

            <div class="destination-activies">
                <h1>Activities</h1>
            </div>

            <br>  <br>  <br>  <br>
            <div class="destination-reviews">
                <h1>Reviews</h1>
            </div>
        </div>
        <br>  <br>  <br>  <br><br>  <br>  <br>  <br>

    </div>

    <div style="position: fixed;text-align: center;bottom: 51px;left: 0;right: 0;background-color: #f9f9f9 ">
        <div style="margin: 10px">
            <a class="button-def ui-shadow" id="bookticket" data-ajax="false" href="BookTickets.html">Book ticket</a>
        </div>

    </div>

    <div data-role="footer" data-position="fixed" class="nav-bar" data-tap-toggle="false">

        <div data-role="navbar" class="nav-bar">

            <ul>
                <li><a href="Home.html" id="homeNav" data-icon="custom" data-ajax="false"></a></li>
                <li><a href="Treasure-hunt.html" id="treasurehuntNav" data-icon="custom" data-ajax="false"   ></a></li>
                <li><a href="Leaderboard.html" id="leaderboardNav" data-icon="custom" data-ajax="false"   ></a></li>
                <li><a href="Profile.html" id="profileNav" data-icon="custom" data-ajax="false"   ></a></li>
            </ul>
        </div>
    </div>
</div>
<script>
    function myFunction(id) {
        window.location.href="Activity-info.html?id=" + id;
        console.log(id);
    }

</script>
</body>
</html>